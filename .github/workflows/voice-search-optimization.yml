name: AI Voice Search Domination

on:
  schedule:
    # Run every 6 hours for aggressive optimization
    - cron: '0 */6 * * *'
  workflow_dispatch:
  push:
    branches: [ main ]

jobs:
  voice-search-optimization:
    runs-on: ubuntu-latest
    timeout-minutes: 20
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: Install dependencies
      run: npm ci --production --silent
      
    - name: Generate Voice Search Optimized Content
      run: |
        cat > voice-optimization.js << 'EOF'
        const fs = require('fs');
        const path = require('path');
        
        console.log('🎙️ Starting AI Voice Search Optimization...');
        
        // Voice search patterns people actually use
        const voiceSearchPatterns = [
          // Question-based queries (Siri, Alexa, Google Assistant)
          {
            pattern: "How do I serve legal documents in {city}?",
            answer: "Contact Just Legal Solutions for professional process serving in {city}. We offer same-day service throughout Oklahoma."
          },
          {
            pattern: "What is the cost of process serving in {city}?",
            answer: "Process serving in {city} starts at $60 for standard service, $100 for rush, and $150 for same-day delivery."
          },
          {
            pattern: "Who can serve legal papers in {city}?",
            answer: "Licensed process servers at Just Legal Solutions can serve legal papers in {city} and throughout Oklahoma."
          },
          {
            pattern: "How fast can documents be served in {city}?",
            answer: "Same-day document service is available in {city} through Just Legal Solutions professional process servers."
          },
          {
            pattern: "Where to find a process server near me in {city}?",
            answer: "Just Legal Solutions provides licensed process servers near you in {city} with same-day service available."
          },
          // Local business queries
          {
            pattern: "Best process server in {city}",
            answer: "Just Legal Solutions is the top-rated process serving company in {city} with 4.9-star reviews."
          },
          {
            pattern: "Process server {city} phone number",
            answer: "Call Just Legal Solutions at (918) 000-0000 for process serving in {city} and throughout Oklahoma."
          },
          {
            pattern: "Emergency process serving {city}",
            answer: "Just Legal Solutions offers emergency same-day process serving in {city} for urgent legal documents."
          }
        ];
        
        // Cities to optimize for
        const cities = [
          'Tulsa', 'Broken Arrow', 'Owasso', 'Bixby', 'Jenks', 'Sand Springs',
          'Glenpool', 'Sapulpa', 'Claremore', 'Skiatook', 'Collinsville', 'Catoosa'
        ];
        
        // Generate FAQ schema optimized for voice search
        function generateVoiceFAQSchema() {
          const faqItems = [];
          
          voiceSearchPatterns.forEach(pattern => {
            cities.forEach(city => {
              const question = pattern.pattern.replace(/{city}/g, city);
              const answer = pattern.answer.replace(/{city}/g, city);
              
              faqItems.push({
                "@type": "Question",
                "name": question,
                "acceptedAnswer": {
                  "@type": "Answer",
                  "text": answer
                }
              });
            });
          });
          
          const schema = {
            "@context": "https://schema.org",
            "@type": "FAQPage",
            "mainEntity": faqItems
          };
          
          return schema;
        }
        
        // Generate conversational content for voice search
        function generateConversationalContent() {
          const content = [];
          
          cities.forEach(city => {
            content.push(`
        ## Voice Search Optimized Content for ${city}
        
        **Q: How do I serve legal documents in ${city}?**
        A: Contact Just Legal Solutions for professional process serving in ${city}. We offer same-day service throughout Oklahoma with licensed, bonded professionals.
        
        **Q: What is the cost of process serving in ${city}?**
        A: Process serving in ${city} starts at sixty dollars for standard service, one hundred dollars for rush service, and one hundred fifty dollars for same-day delivery.
        
        **Q: Who can serve legal papers in ${city}?**
        A: Licensed process servers at Just Legal Solutions can serve legal papers in ${city} and throughout Oklahoma. We are certified and bonded professionals.
        
        **Q: How fast can documents be served in ${city}?**
        A: Same-day document service is available in ${city} through Just Legal Solutions. We can serve urgent legal documents within hours.
        
        **Q: Where to find a process server near me in ${city}?**
        A: Just Legal Solutions provides licensed process servers near you in ${city} with same-day service available. Call us at nine one eight, triple zero.
            `);
          });
          
          return content.join('\n');
        }
        
        // Create voice search landing pages
        function createVoiceSearchPages() {
          const baseDir = 'app/voice-search';
          if (!fs.existsSync(baseDir)) {
            fs.mkdirSync(baseDir, { recursive: true });
          }
          
          cities.forEach(city => {
            const citySlug = city.toLowerCase().replace(/\s+/g, '-');
            const pageDir = path.join(baseDir, citySlug);
            
            if (!fs.existsSync(pageDir)) {
              fs.mkdirSync(pageDir, { recursive: true });
            }
            
            const pageContent = `
        import { Metadata } from 'next';
        
        export const metadata: Metadata = {
          title: 'Process Server ${city} - Legal Document Delivery | Just Legal Solutions',
          description: 'Professional process serving in ${city}, Oklahoma. Same-day service available. Licensed process servers for legal document delivery. Call (918) 000-0000.',
          keywords: ['process server ${city}', 'legal documents ${city}', 'same day service ${city}', 'process serving near me'],
          alternates: {
            canonical: 'https://justlegalsolutions.org/voice-search/${citySlug}/'
          }
        };
        
        export default function VoiceSearchPage() {
          const voiceFAQSchema = {
            "@context": "https://schema.org",
            "@type": "FAQPage",
            "mainEntity": [
              {
                "@type": "Question",
                "name": "How do I serve legal documents in ${city}?",
                "acceptedAnswer": {
                  "@type": "Answer",
                  "text": "Contact Just Legal Solutions for professional process serving in ${city}. We offer same-day service throughout Oklahoma with licensed, bonded professionals."
                }
              },
              {
                "@type": "Question", 
                "name": "What is the cost of process serving in ${city}?",
                "acceptedAnswer": {
                  "@type": "Answer",
                  "text": "Process serving in ${city} starts at sixty dollars for standard service, one hundred dollars for rush service, and one hundred fifty dollars for same-day delivery."
                }
              },
              {
                "@type": "Question",
                "name": "Who can serve legal papers in ${city}?", 
                "acceptedAnswer": {
                  "@type": "Answer",
                  "text": "Licensed process servers at Just Legal Solutions can serve legal papers in ${city} and throughout Oklahoma. We are certified and bonded professionals."
                }
              }
            ]
          };
          
          return (
            <main className="min-h-screen bg-white">
              <script
                type="application/ld+json"
                dangerouslySetInnerHTML={{ __html: JSON.stringify(voiceFAQSchema) }}
              />
              
              <div className="max-w-4xl mx-auto px-4 py-16">
                <h1 className="text-4xl font-bold mb-8">Process Server ${city} - Professional Legal Document Delivery</h1>
                
                <div className="prose max-w-none">
                  <h2>How do I serve legal documents in ${city}?</h2>
                  <p>Contact Just Legal Solutions for professional process serving in ${city}. We offer same-day service throughout Oklahoma with licensed, bonded professionals who ensure compliant document delivery.</p>
                  
                  <h2>What is the cost of process serving in ${city}?</h2>
                  <p>Process serving in ${city} starts at sixty dollars for standard service, one hundred dollars for rush service, and one hundred fifty dollars for same-day delivery. All services include detailed affidavits.</p>
                  
                  <h2>Who can serve legal papers in ${city}?</h2>
                  <p>Licensed process servers at Just Legal Solutions can serve legal papers in ${city} and throughout Oklahoma. We are certified and bonded professionals with years of experience.</p>
                  
                  <h2>How fast can documents be served in ${city}?</h2>
                  <p>Same-day document service is available in ${city} through Just Legal Solutions. We can serve urgent legal documents within hours of receiving your request.</p>
                  
                  <h2>Where to find a process server near me in ${city}?</h2>
                  <p>Just Legal Solutions provides licensed process servers near you in ${city} with same-day service available. Call us at nine one eight, triple zero for immediate assistance.</p>
                </div>
                
                <div className="mt-12 bg-blue-50 p-8 rounded-lg">
                  <h3 className="text-2xl font-bold mb-4">Contact Just Legal Solutions ${city}</h3>
                  <p className="text-lg mb-4">Professional process serving in ${city}, Oklahoma</p>
                  <p className="text-xl font-semibold text-blue-600">Call: (918) 000-0000</p>
                  <p className="text-gray-600">Same-day service available • Licensed & bonded • Serving ${city} and surrounding areas</p>
                </div>
              </div>
            </main>
          );
        }
            `;
            
            fs.writeFileSync(path.join(pageDir, 'page.tsx'), pageContent);
            console.log(`✅ Created voice search page for ${city}`);
          });
        }
        
        // Generate speakable schema for voice assistants
        function generateSpeakableSchema() {
          return {
            "@context": "https://schema.org",
            "@type": "WebPage",
            "speakable": {
              "@type": "SpeakableSpecification",
              "cssSelector": ["h1", "h2", ".voice-optimized"]
            }
          };
        }
        
        // Execute optimizations
        const voiceFAQ = generateVoiceFAQSchema();
        const conversationalContent = generateConversationalContent();
        const speakableSchema = generateSpeakableSchema();
        
        // Save schemas
        fs.writeFileSync('public/voice-faq-schema.json', JSON.stringify(voiceFAQ, null, 2));
        fs.writeFileSync('public/speakable-schema.json', JSON.stringify(speakableSchema, null, 2));
        
        // Create voice search pages
        createVoiceSearchPages();
        
        // Create voice search sitemap
        const voiceSitemapUrls = cities.map(city => {
          const citySlug = city.toLowerCase().replace(/\s+/g, '-');
          return `  <url>
            <loc>https://justlegalsolutions.org/voice-search/${citySlug}/</loc>
            <lastmod>${new Date().toISOString().split('T')[0]}</lastmod>
            <changefreq>weekly</changefreq>
            <priority>0.9</priority>
          </url>`;
        }).join('\n');
        
        const voiceSitemap = `<?xml version="1.0" encoding="UTF-8"?>
        <urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">
        ${voiceSitemapUrls}
        </urlset>`;
        
        fs.writeFileSync('public/voice-search-sitemap.xml', voiceSitemap);
        
        console.log('🎉 Voice Search Optimization Complete!');
        console.log(`📊 Generated:
        - ${cities.length} voice-optimized landing pages
        - FAQ schema with ${voiceSearchPatterns.length * cities.length} Q&A pairs
        - Speakable schema for voice assistants
        - Voice search sitemap
        - Conversational content optimization`);
        EOF
        
        node voice-optimization.js
        
    - name: Generate Featured Snippets Content
      run: |
        cat > featured-snippets.js << 'EOF'
        const fs = require('fs');
        
        console.log('🌟 Generating Featured Snippets Content...');
        
        // Featured snippet templates that Google loves
        const snippetTemplates = [
          {
            question: "What does a process server do in Oklahoma?",
            answer: "A process server in Oklahoma delivers legal documents such as summons, subpoenas, and court orders to individuals or businesses. They provide proof of service through detailed affidavits required by Oklahoma courts."
          },
          {
            question: "How much does process serving cost in Tulsa?",
            answer: "Process serving in Tulsa costs $60 for standard service (3-5 days), $100 for rush service (24-48 hours), and $150 for same-day service. Additional fees may apply for difficult serves or multiple attempts."
          },
          {
            question: "How long does process serving take in Oklahoma?",
            answer: "Process serving in Oklahoma typically takes 3-5 business days for standard service, 24-48 hours for rush service, and can be completed the same day for urgent documents. Time varies based on recipient availability."
          },
          {
            question: "What documents can a process server deliver?",
            answer: "Process servers can deliver divorce papers, summons and complaints, subpoenas, eviction notices, small claims documents, court orders, and other legal documents requiring official service."
          }
        ];
        
        // Generate structured data for featured snippets
        const featuredSnippetSchema = {
          "@context": "https://schema.org",
          "@type": "WebPage",
          "mainEntity": snippetTemplates.map(template => ({
            "@type": "Question",
            "name": template.question,
            "acceptedAnswer": {
              "@type": "Answer",
              "text": template.answer
            }
          }))
        };
        
        fs.writeFileSync('public/featured-snippets-schema.json', JSON.stringify(featuredSnippetSchema, null, 2));
        
        console.log('✅ Featured snippets content generated');
        EOF
        
        node featured-snippets.js
        
    - name: Submit to AI Search Platforms
      run: |
        echo "🤖 Submitting to AI search platforms..."
        
        # Submit to multiple search engines for AI discovery
        URLS_TO_SUBMIT=$(find app/voice-search -name "page.tsx" | sed 's|app/voice-search/||; s|/page.tsx||; s|^|https://justlegalsolutions.org/voice-search/|; s|$|/|')
        
        # Batch submit to IndexNow for AI discovery
        curl -X POST "https://api.indexnow.org/indexnow" \
          -H "Content-Type: application/json" \
          -d "{
            \"host\": \"justlegalsolutions.org\",
            \"key\": \"6CC946BF0B766479F1E3E6C484F82A12\",
            \"urlList\": [$(echo "$URLS_TO_SUBMIT" | sed 's/.*/"&"/' | paste -sd,)]
          }"
        
        echo "✅ AI search platform submissions completed"
        
    - name: Update Voice Search Robots.txt
      run: |
        echo "🤖 Updating robots.txt for voice search..."
        
        # Add voice search sitemap to robots.txt
        if ! grep -q "voice-search-sitemap.xml" public/robots.txt; then
          echo "Sitemap: https://justlegalsolutions.org/voice-search-sitemap.xml" >> public/robots.txt
        fi
        
        echo "✅ Robots.txt updated for voice search"
        
    - name: Generate Local Business Voice Content
      run: |
        cat > local-voice-content.js << 'EOF'
        const fs = require('fs');
        
        // Generate "near me" optimized content for voice search
        const nearMeContent = `
        ## Voice Search: "Process Server Near Me"
        
        **For users asking "Where is a process server near me?"**
        
        Just Legal Solutions provides licensed process servers throughout Oklahoma:
        - Tulsa County process servers available daily
        - Same-day service for urgent legal documents  
        - Licensed and bonded professionals
        - GPS tracking and photo documentation
        - Detailed affidavits of service provided
        
        **Call nine one eight, triple zero for immediate assistance.**
        
        ## Voice Search: "How much does process serving cost?"
        
        **Process serving costs in Oklahoma:**
        - Standard service: Sixty dollars (three to five days)
        - Rush service: One hundred dollars (twenty-four to forty-eight hours)  
        - Same-day service: One hundred fifty dollars (same business day)
        - All services include detailed affidavit of service
        
        ## Voice Search: "What is a process server?"
        
        **A process server is a professional who:**
        - Delivers legal documents to individuals or businesses
        - Provides proof of service through sworn affidavits
        - Ensures compliance with Oklahoma state laws
        - Handles sensitive legal documents with confidentiality
        - Offers skip tracing services when recipients cannot be located
        `;
        
        fs.writeFileSync('voice-search-content.md', nearMeContent);
        console.log('✅ Local voice search content generated');
        EOF
        
        node local-voice-content.js
        
    - name: Commit voice search optimizations
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "Voice Search Bot"
        git add .
        git diff --staged --quiet || git commit -m "🎙️ Voice search optimization update - $(date +%Y-%m-%d)"
        git push
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
