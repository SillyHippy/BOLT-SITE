name: IndexNow Push on Deploy

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  indexnow-push:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        
      - name: Notify Search Engines
        run: |
          echo "Notifying search engines of updates..."
          
          # To enable IndexNow: 
          # 1. Go to https://www.bing.com/indexnow and generate a key
          # 2. Add it as a GitHub secret named INDEXNOW_KEY
          # 3. Create a file public/<key>.txt containing the key
          # IndexNow is currently disabled until a real key is configured.
          
          if [ -n "${{ secrets.INDEXNOW_KEY }}" ]; then
            KEY="${{ secrets.INDEXNOW_KEY }}"
            KEY_URLS=(
              "https://justlegalsolutions.org/"
              "https://justlegalsolutions.org/contact"
              "https://justlegalsolutions.org/tulsa-process-server"
              "https://justlegalsolutions.org/law-firm-services"
              "https://justlegalsolutions.org/oklahoma-process-server-pricing"
              "https://justlegalsolutions.org/oklahoma-process-server-laws"
              "https://justlegalsolutions.org/ultimate-guide-process-serving-oklahoma"
            )
            
            for url in "${KEY_URLS[@]}"; do
              curl -s -X POST "https://api.indexnow.org/indexnow" \
                -H "Content-Type: application/json" \
                -d "{\"host\":\"justlegalsolutions.org\",\"key\":\"$KEY\",\"keyLocation\":\"https://justlegalsolutions.org/$KEY.txt\",\"urlList\":[\"$url\"]}" \
                || echo "IndexNow ping failed for $url"
            done
            echo "IndexNow notifications sent"
          else
            echo "IndexNow key not configured - skipping. Add INDEXNOW_KEY secret to enable."
          fi
          
          # Ping Google and Bing sitemaps (always works, no key needed)
          curl -s "https://www.google.com/ping?sitemap=https://justlegalsolutions.org/sitemap.xml" || echo "Google ping failed"
          curl -s "https://www.bing.com/ping?sitemap=https://justlegalsolutions.org/sitemap.xml" || echo "Bing ping failed"
          
          echo "Search engine notifications completed"
